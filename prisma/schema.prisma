generator client {
  provider   = "prisma-client-js"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Post {
  id              String          @id @default(cuid())
  category        Category
  title           String
  subtitle        String?
  description     String
  image           String
  author          String
  authorAvatar    String?
  location        String
  price           Int?
  priceLabel      String?
  rating          Float?
  ratingCount     Int?
  tags            String[]
  urgent          Boolean         @default(false)
  date            DateTime?
  payment         PaymentMethod[]
  barterAccepted  Boolean         @default(false)
  // Permisos y visibilidad
  authorId        String?
  expiresAt       DateTime?
  privateInfo     String?
  contactVisibility ContactVisibility?
  contactFlow     ContactFlow?
  commitCommunity Boolean?
  commitRespectRules Boolean?
  // Metadata de creaci√≥n (request)
  createdIp            String?
  createdUserAgent     String?
  createdAcceptLanguage String?
  createdTimezone      String?
  createdReferrer      String?
  startDate       DateTime?
  endDate         DateTime?
  venue           String?
  mode            Mode?
  capacity        Int?
  organizer       String?
  experienceYears Int?
  availability    String?
  serviceArea     String?
  condition       Condition?
  stock           Int?
  warranty        String?
  usageTime       String?
  duration        String?
  schedule        String?
  level           Level?
  neededBy        String?
  budgetRange     String?
  status          PostStatus      @default(pending)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  socials         SocialLink[]
  user            User?           @relation(fields: [authorId], references: [id])
  reports         Report[]

  @@index([category])
  @@index([status])
  @@index([createdAt])
  @@index([authorId])
}

model SocialLink {
  id        String   @id @default(cuid())
  postId    String
  name      String
  url       String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, name])
  @@index([postId])
}

model ModerationLog {
  id         String   @id @default(cuid())
  actor      String
  action     String
  targetType String
  targetId   String
  reason     String?
  createdAt  DateTime @default(now())

  @@index([targetType, targetId])
}

model User {
  id             String     @id @default(cuid())
  email          String     @unique
  passwordHash   String
  avatar         String?
  name           String?
  phone          String?
  dni            String?
  role           Role       @default(user)
  status         UserStatus @default(pending)
  emailVerified  DateTime?
  verifiedPublic Boolean    @default(false)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  posts          Post[]
}

model VerificationToken {
  identifier String
  token      String   @id
  expires    DateTime
}

enum Category {
  eventos
  servicios
  productos
  usados
  cursos
  pedidos
}

enum Mode {
  presencial
  online
  hibrido
}

enum Level {
  principiante
  intermedio
  avanzado
}

enum Condition {
  nuevo
  reacondicionado
  usado
}

enum PaymentMethod {
  cash
  debit
  credit
  transfer
  mercadopago
  crypto
  barter
  all
}

enum PostStatus {
  pending
  approved
  rejected
}


enum Role {
  user
  moderator
  admin
}

enum UserStatus {
  pending
  approved
  rejected
}
model Report {
  id             String   @id @default(cuid())
  postId         String
  userId         String?
  reason         String
  message        String?
  ip             String?
  userAgent      String?
  acceptLanguage String?
  timezone       String?
  referrer       String?
  createdAt      DateTime @default(now())
  post           Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([createdAt])
}
enum ContactVisibility {
  public
  gated
}

enum ContactFlow {
  seller_contacts
  buyer_contacts_first
}
